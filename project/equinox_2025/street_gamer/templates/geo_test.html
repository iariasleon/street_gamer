<!DOCTYPE html>
<html>
<head>
    <title>Prueba de Geolocalización</title>
</head>
<body>
    <h1>Enviar ubicación al servidor</h1>
    <button id="sendLocation">Enviar mi ubicación</button>

    <div id="result" style="margin-top: 20px;"></div>

    <script>
    const token = "8390af118ee15edeeb60a854b20d9a1200df42ea"; // reemplaza con tu token

    document.getElementById("sendLocation").addEventListener("click", () => {
        if (!navigator.geolocation) {
            alert("Tu navegador no soporta geolocalización");
            return;
        }

        navigator.geolocation.getCurrentPosition(
            position => {
                const data = {
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude
                };

                fetch("http://127.0.0.1:8000/location/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Token " + token
                    },
                    body: JSON.stringify(data)
                })
                .then(res => res.json())
                .then(resp => {
                    let html = `<p><b>Ubicación enviada:</b> ${resp.latitude}, ${resp.longitude}</p>`;

                    if (resp.reached_places && resp.reached_places.length > 0) {
                        html += "<p><b>Lugares alcanzados:</b></p><ul>";
                        resp.reached_places.forEach(p => {
                            html += `<li>${p.place} - ${p.distance_m} metros - Pregunta: ${p.question}</li>`;
                        });
                        html += "</ul>";
                    } else {
                        html += "<p>No has llegado a ningún lugar aún</p>";
                    }

                    document.getElementById("result").innerHTML = html;
                })
                .catch(err => {
                    console.error(err);
                    alert("Error enviando ubicación");
                });
            },
            error => {
                console.error(error);
                alert("No se pudo obtener la ubicación");
            },
            { enableHighAccuracy: true }
        );
    });
    </script>
</body>
</html>
